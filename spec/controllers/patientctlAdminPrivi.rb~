require 'spec_helper.rb'
require 'faker'

describe PatientsController, type: :controller do
	before(:each) do
		@admin = FactoryGirl.create(:admin)
		controller.current_user = @admin.user
		@patient = FactoryGirl.create(:patient)
	end 

	it "show patient as admin" do
		show_action()
		check
	end
	
	it "redirect_show_patient, as admin"do
		show_action()
		expect(response).to be_success
	end	

	it "new_patient as admin" do
		new_action()
		expect(response).to be_success
	end

	it "create_patietn as admin"do
		expect{create_action()}.to change(Patient, :count).by(1)
	end

	
	it "create_patient_flash admin" do
		create_action()
		expect(flash[:notice]).to eq("successfully added patient")
	end
	
	it "create_patient_redirection admin" do
		create_action()
		expect(response).to redirect_to :action => :edit, :id => 2
	end

#requires further testing with pool privilges 
	it "edit_patient as admin" do
		edit_action()
		expect(response).to be_success
	end
=begin
test this with the privileges
	it "update_patient as admin" do
		puts @admin.user.name
		update_action()
		expect(response).to be_success
	end
=end
private 
	def check
		assert_equal @patient, assigns(:patient)
	end

	def show_action	
		get :show, {'id' => @patient.id}, {'user_id' => @admin.id}
	end

	def new_action
		get :new
	end
	
	def create_action
		get :create, patient: attributes_for(:patient), user: attributes_for(:user) 
	end
	
	def edit_action
		get :edit, id: @patient.id
	end
	
	def update_action
		get :update, 'patient' => { :func => "addPool"}, user: attributes_for(:user), 'id' => @patient.id

	end
end
